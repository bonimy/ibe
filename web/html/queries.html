<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<title>IRSA Image Server - Queries</title>
	<link href="docs.css" type="text/css" rel="stylesheet" />
	<link href="prettify/prettify.css" type="text/css" rel="stylesheet" />
	<script type="text/javascript" src="prettify/prettify.js"></script>
	<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.0/jquery.min.js"></script>
</head>
<body>

<script>
fireflyToolbar= {
        "rootComponentsURL" : "http://irsa.ipac.caltech.edu",
        "direct" : true,
        };
</script>

<div id="irsa-banner"   style= "min-width:768px; min-height:95px"></div>
<script type="text/javascript" language='javascript' src='http://irsa.ipac.caltech.edu/frontpage/frontpage.nocache.js'> </script>

<div class="content">

<h1><a href="index.html">IRSA Image Server</a> - Queries</h1>

<ul>
	<li><a href="#overview">Overview</a></li>
	<li><a href="#columns">Column listings</a></li>
	<li><a href="#relational">Relational queries</a></li>
	<li><a href="#spatial">Spatial queries</a></li>
	<li><a href="#examples">Examples</a></li>
	<li><a href="#upload">Table uploads</a></li>
	<li><a href="#help">Getting Help</a></li>
</ul>

<a name="overview" />
<h3>Overview</h3>
<p>
	The query layer of the IRSA Image Server provides the ability to perform
	spatial and/or relational queries on image metadata tables, with output in
	<a href="http://irsa.ipac.caltech.edu/applications/DDGEN/Doc/ipac_tbl.html">IPAC ASCII table</a>,
	comma-separated-value (CSV), or tab-separated-value (TSV) format. Queries
	are performed by appending a
	<a href="http://en.wikipedia.org/wiki/Query_string">query string</a>
	to a base URL identifying the table to query. The available tables are
	browsable <a href="search/">here</a>. The query output format is controlled
	by the <span class="param">ct</span> parameter, which may always be specified,
	regardless of the query type. The following values are recognized:
</p>
<table>
	<tr><td class="param">ct=html</td><td>Pretty-printed HTML</td></tr>
	<tr><td class="param">ct=ipac_table</td><td><a href="http://irsa.ipac.caltech.edu/applications/DDGEN/Doc/ipac_tbl.html">IPAC ASCII table</a> format</td></tr>
	<tr><td class="param">ct=csv</td><td>Comma-separated-value format</td></tr>
	<tr><td class="param">ct=tsv</td><td>Tab-separated-value format</td></tr>
</table>

<a name="columns" />
<h3>Column listings</h3>
<p>
	To see the columns of a particular image metadata table, append the
	<span class="param">FORMAT</span> parameter with a value equal to METADATA
	to the base URL. For example,
	<a href="search/wise/allsky/4band_p1bm_frm?FORMAT=METADATA&amp;ct=html"><span class="root">&lt;root&gt;</span>/search/wise/allsky/4band_p1bm_frm?FORMAT=METADATA&amp;ct=html</a>
	will return a listing of the WISE All-Sky Release Level 1B Frame
	metadata table columns in HTML format.
</p>

<a name="relational" />
<h3>Relational queries</h3>
<p>
	The following parameters can be used to specify relational (SQL) queries.
	Note that they can be combined with a spatial constraint (documented
	<a href="#spatial">below</a>).
</p>
<dl>
	<dt><span class="param">columns</span>=name1,name2,....</dt>
	<dd>
		<p>
			The <span class="param">columns</span> parameter value must
			be set to a comma separated list of the column names that should
			be output. If this argument is omitted, a table specific
			default column-set is used.
		</p>
		
		<p>Examples:</p>
		<ul>
			<li class="param">columns=scan_id,frame_num,band</li>
			<li class="param">columns=coadd_id,magzp</li>
		</ul>
	</dd>
	<dt><span class="param">where</span>=SQL</dt>
	<dd>
		<p>
			The <span class="param">where</span> parameter can be set to a SQL
			<a href="http://en.wikipedia.org/wiki/Where_(SQL)">WHERE clause</a>,
			with some restrictions. Notably, function calls and sub-queries
			are not supported. You can use AND, OR, NOT, IN, BETWEEN, LIKE, IS,
			the usual arithmetic and comparison operators, and literal values.
		</p>
		<p>
			Note that the <span class="param">where</span> parameter is
			<strong>required</strong> in the absence of 
			<span class="param">POS</span> (a spatial constraint).
		</p>
		<p>
			WHERE clauses should be
			<a href="http://en.wikipedia.org/wiki/Query_string#URL_encoding">URL encoded</a>.
			Examples:
		</p>
		<table>
			<tr><td class="param">band IN (1,2,3)</td>
				<td><strong> → </strong><tt>band%20IN%20(1,2,3)</tt></td></tr>
			<tr><td class="param">crval1 between 19 and 21 and (crval2&gt;39 and crval2&lt;41)</td>
				<td><strong> → </strong><tt>crval1%20between%2019%20and%2021%20and%20(crval2%3E39%20and%20crval2%3C41)</tt></td></tr>
		</table>
	</dd>
</dl>

<a name="spatial" />
<h3>Spatial queries</h3>
<p>
	Spatial queries return images that are related to a search region
	(specified via the <span class="param">POS</span> and
	<span class="param">SIZE</span> parameters) according to a spatial
	predicate (specified via the <span class="param">INTERSECT</span>
	parameter).
</p>
<dl>
	<dt><span class="param">POS</span>=ra,dec</dt>
	<dd>
		<p>
			The <span class="param">POS</span> parameter value must consist of 
			an ICRS right ascension and declination in decimal degrees. It identifies
			the point which returned images must contain, or the center of the search
			region. The coordinate values must be separated by a comma; no embedded
			whitespace is allowed.
		</p>
		<p>
			<span class="param">POS</span> is <strong>required</strong> in the
			absence of <span class="param">where</span>.
		</p>
		<p>Examples:</p>
		<ul>
			<li class="param">POS=359,10</li>
			<li class="param">POS=10,-89.5</li>
		</ul>
	</dd>
	<dt><span class="param">SIZE</span>=width[,height]</dt>
	<dd>
		<p>
			The <span class="param">SIZE</span> parameter consists of one or two
			(comma separated) values in decimal degrees. The first SIZE value
			is taken to be the full-width of the search region along the east axis
			at <span class="param">POS</span>, and the second is taken to be the
			full-height along the north axis. Taken together,
			<span class="param">POS</span> and <span class="param">SIZE</span>
			define a convex spherical polygon on the sky with great circle edges -
			the search region. During a query, this region is compared against the
			convex spherical polygons formed by connecting the 4 corners of each
			image in a data-set to determine which images should be returned.
		</p>
		<p>
			If only one size value is specified, it is used as both the full-width
			and full-height. Negative sizes are illegal, and a width and height
			of zero indicate that the search region is a point.
		</p>
		<p>
			<span class="param">SIZE</span> is an optional parameter.
			If unspecified, the default search region width and height
			is 0 (i.e. the search region is just the point
			<span class="param">POS</span>). Note also that if
			<span class="param">INTERSECT</span>=CENTER (see below),
			<span class="param">SIZE</span> is ignored.
		</p>
		<p>Examples:</p>
		<ul>
			<li class="param">SIZE=0.1</li>
			<li class="param">SIZE=1,2</li>
		</ul>
	</dd>
	<dt><span class="param">INTERSECT</span>=value</dt>
	<dd>
		<p>
			The <span class="param">INTERSECT</span> parameter specifies a
			spatial predicate that specifies how the search region S and the
			spatial extents of a candidate image X must be related.
			Four values are allowed:
		</p>
		<ul>
			<li><strong>COVERS</strong>: X must completely contain S.
				Equivalent to CENTER and OVERLAPS if S is a point.</li>
			<li><strong>ENCLOSED</strong>: S must completely contain X. If
				S is a point, the query will always return an empty image table.</li>
			<li><strong>CENTER</strong>: X must contain the center of S.
				If S is a point, this is equivalent to COVERS and OVERLAPS.</li>
			<li><strong>OVERLAPS</strong>: The intersection of S and X is non-empty.
				If S is a point, this is equivalent to CENTER and COVERS.</li>
		</ul>
		<p>
			The <span class="param">INTERSECT</span> parameter is optional;
			if unspecified, it defaults to OVERLAPS.
		</p>
		<p>
			The spatial extent of an image is approximated by connecting
			its corners with great circles to form a spherical convex polygon.
			The search region as defined by this service is also a spherical
			convex polygon (or a point). Spatial predicate evaluation
			is performed on pairs of spherical convex polygons without
			recourse to any performance motivated short-cuts. Nevertheless,
			the implementation uses floating point arithmetic and results are
			therefore not guaranteed to be mathematically exact. Note also
			that the spatial extent of an image with a non-gnomonic projection
			(or large distortion terms) may not be well approximated by
			the technique employed. However, the images currently
			being served have gnomonic or orthographic projections, are of
			small area and have small distortion terms - hence, we believe
			our approximations are accurate enough to be useful.
		</p>
	</dd>
	<dt><span class="param">mcen</span></dt>
	<dd>
		<p>
			The <span class="param">mcen</span> parameter indicates that only
			the most centered image/image set (with respect to
			<span class="param">POS</span>) should be returned, rather than
			all images/image sets containing <span class="param">POS</span>.
			If the <span class="param">SIZE</span> parameter is specified and
			non-zero, the <span class="param">mcen</span> parameter is ignored
			(except when <span class="param">INTERSECT</span>=CENTER).
		</p>
		<p>
			Note that <span class="param">mcen</span> is not required to have
			a value. If one is nevertheless specified, it is ignored.
		</p>
	</dd>
</dl>

<a name="examples" />
<h3>Examples</h3>
<p>Here is a query returning all WISE All-Sky Release Level 1b Frames 
   containing (ra,dec) = (20,40) in bands W1 and W2:
</p>
<ul><li><a href="search/wise/allsky/4band_p1bm_frm?POS=20,40&amp;where=band+in+(1,2)"><span class="root">&lt;root&gt;</span>/search/wise/allsky/4band_p1bm_frm?POS=20,40&amp;where=band+in+(1,2)</a></li></ul>

<p>And here is a query returning the most centered WISE All-Sky Atlas W1 coadd
   with respect to (ra,dec) = (20,40):
</p>
<ul><li><a href="search/wise/allsky/4band_p3am_cdd?POS=20,40&amp;mcen&amp;where=band%3D1"><span class="root">&lt;root&gt;</span>/search/wise/allsky/4band_p3am_cdd?POS=20,40&amp;mcen&amp;where=band%3D1</a></li></ul>

<a name="upload" />
<h3>Table uploads</h3>
<p>
	It is also possible to search for multiple positions in one query (rather
	than issuing a series of spatial queries). This can be accomplished by setting
	the value of the <span class="param">POS</span> parameter to the contents of an
	<a href="http://irsa.ipac.caltech.edu/applications/DDGEN/Doc/ipac_tbl.html">IPAC ASCII table</a>
	file containing search positions. The query must be submitted via an HTTP
	<a href="http://en.wikipedia.org/wiki/POST_(HTTP)">POST</a> rather
	than a <a href="http://en.wikipedia.org/wiki/GET_(HTTP)#Request_methods">GET</a>,
	and the table file must contain two columns named <strong>ra</strong> and
	<strong>dec</strong> such that each row corresponds to a single
	<span class="param">POS</span> value. Any other columns in the table are
	ignored. Here's an example IPAC ASCII table (download it <a href="example.tbl">here</a>):
</p>
<pre>|ra     |dec    |
|double |double |
    70.5    20.1 
    19.5    39.5 
   270.0   -30.3 
</pre>
<p>
	And here are UNIX shell commands that demonstrate how to query for images
	overlapping these positions using <a href="http://curl.haxx.se/">curl</a>:
</p>
<pre class="prettyprint lang-bsh">
# Download the example table
curl "<span class="server">&lt;server&gt;</span><span class="root">&lt;root&gt;</span>/example.tbl" &gt; example.tbl
# ... and upload it to perform a query
curl -F INTERSECT=CENTER -F "POS=@example.tbl" "<span class="server">&lt;server&gt;</span><span class="root">&lt;root&gt;</span>/search/wise/allsky/4band_p1bm_frm"</pre>


<a name="help" />
<h3>Getting Help</h3>
<p>
	If you've run into a problem, think you've found a bug, or simply have questions, please contact
	<a href="https://irsasupport.ipac.caltech.edu/">IRSA User Support</a>.
</p>

</div>

<script type="text/javascript"><!--
	$(document).ready(function() {
		var root, i =  window.location.pathname.lastIndexOf("/");
		if (i < 0) {
			root = "";
		} else {
			root = window.location.pathname.substring(0, i);
		}
		var server = window.location.protocol + '//' + window.location.host;
		$('span.server').text(server);
		$('span.root').text(root);
	});
	$(document).ready(prettyPrint);
--></script>

<div id="irsa-footer" style="position:absolute;left:0;right:0;margin-top:20px">
<iframe src="http://irsa.ipac.caltech.edu/frontpage/footer.html" width="100%" frameborder=0 scrolling=0 seamless=1/>
</div>  <!-- end #irsa-footer -->

</body>
</html>
